===========================================================
ğŸ› ï¸ CREATING A CUSTOM SYSTEMD SERVICE - PRACTICAL EXAMPLE
===========================================================

ğŸ”¹ GOAL:
Create a systemd service that:
- Runs a custom shell script
- Automatically restarts if it stops
- Logs events to the system journal
- Starts on boot

-----------------------------------------------------------
ğŸ“„ STEP 1: CREATE A DUMMY APPLICATION
-----------------------------------------------------------

1. Create the shell script:

    sudo vim /usr/local/bin/myapp.sh

2. Paste this code:

    #!/bin/bash
    logger -t MyApp -p user.info "My App started"
    sleep 5
    logger -t MyApp -p user.err "My App crashed"
    exit 0

3. Make it executable:

    sudo chmod +x /usr/local/bin/myapp.sh

This simulates an app that runs for 5 seconds, logs startup and failure messages, then exits.

-----------------------------------------------------------
ğŸ“„ STEP 2: UNDERSTAND SYSTEMD SERVICE FILES
-----------------------------------------------------------

- systemd uses `.service` unit files to manage services.
- A basic service file includes 3 sections:
  â–ª [Unit] â€“ Description & dependencies
  â–ª [Service] â€“ How to start and manage the process
  â–ª [Install] â€“ When to start it (boot target)

Useful man pages:
  â–ª man systemd.service
  â–ª man systemd.unit
  â–ª man systemd.exec
  â–ª man systemd.kill

-----------------------------------------------------------
ğŸ“‚ STEP 3: COPY A TEMPLATE SERVICE FILE
-----------------------------------------------------------

1. Use an existing service as a base:

    sudo cp /lib/systemd/system/ssh.service /etc/systemd/system/myapp.service

2. Edit the new file:

    sudo vim /etc/systemd/system/myapp.service

-----------------------------------------------------------
ğŸ“ STEP 4: DEFINE THE SERVICE FILE
-----------------------------------------------------------

Final file: `/etc/systemd/system/myapp.service`

    [Unit]
    Description=My Custom App
    After=network.target auditd.service

    [Service]
    ExecStartPre=/bin/echo "Preparing to start MyApp..."
    ExecStart=/usr/local/bin/myapp.sh
    Restart=always
    RestartSec=1
    KillMode=process
    Type=simple

    [Install]
    WantedBy=multi-user.target

Explanation:
  â–ª After=... â†’ Start after network is up
  â–ª ExecStartPre=... â†’ Runs just before main process
  â–ª Restart=always â†’ Restarts every time it exits
  â–ª RestartSec=1 â†’ 1s delay to prevent restart loops
  â–ª Type=simple â†’ For simple foreground scripts

-----------------------------------------------------------
ğŸ“¦ STEP 5: ENABLE & START THE SERVICE
-----------------------------------------------------------

1. Reload systemd:

    sudo systemctl daemon-reexec
    sudo systemctl daemon-reload

2. Start the service:

    sudo systemctl start myapp.service

3. (Optional) Enable it at boot:

    sudo systemctl enable myapp.service

-----------------------------------------------------------
ğŸ§ª STEP 6: CHECK LOGS & VERIFY BEHAVIOR
-----------------------------------------------------------

1. Monitor logs in real time:

    journalctl -f

You should see:
  â–ª Startup info log
  â–ª After 5s, a red error log
  â–ª systemd restarts the app automatically

2. Exit logs:

    CTRL + C

-----------------------------------------------------------
ğŸ“Œ USEFUL TIPS
-----------------------------------------------------------

- Restart values:
  â–ª no | on-success | on-failure | always

- KillMode:
  â–ª process â†’ Kill only main process
  â–ª control-group â†’ Kill main + children

- Type options:
  â–ª simple â†’ Foreground (default for scripts)
  â–ª oneshot â†’ Runs once and exits
  â–ª forking â†’ Daemonizes itself
  â–ª notify â†’ App tells systemd when ready

- Use `/lib/systemd/system/` to find more examples

-----------------------------------------------------------
âœ… SUMMARY
-----------------------------------------------------------

- systemd makes services easy to control and reliable.
- This demo shows how to build, configure, and supervise your own.
- Just a few lines in a `.service` file give you full lifecycle management.

===========================================================
